<ResourceDictionary xmlns="http://schemas.microsoft.com/winfx/2006/xaml/presentation"
                    xmlns:x="http://schemas.microsoft.com/winfx/2006/xaml"
                    xmlns:local="clr-namespace:MoSeqAcquire.Views.Metadata"
                    xmlns:converters="clr-namespace:MoSeqAcquire.Views.Converters"
                    xmlns:extensions="clr-namespace:MoSeqAcquire.Views.Extensions"
                    xmlns:mah="http://metro.mahapps.com/winfx/xaml/controls"
                    xmlns:materialDesign="http://materialdesigninxaml.net/winfx/xaml/themes"
                    xmlns:ext="clr-namespace:MoSeqAcquire.Views.Extensions">

    <converters:GenericConverter x:Key="GenericConverter" />
    <converters:EnumToVisibilityConverter x:Key="EnumToVisibilityConverter" />
    <converters:StringEmptyVisibilityConverter x:Key="StringEmptyVisibilityConverter" />
    <converters:BooleanInvertConverter x:Key="BooleanInvertConverter" />

    <local:MetadataItemDataTemplateSelector x:Key="MetadataItemDataTemplateSelector" />
    <local:MetadataItemEditorDataTemplateSelector x:Key="MetadataItemEditorDataTemplateSelector" />
    <local:ChoicesConstraintEditorDataTemplateSelector x:Key="ChoicesConstraintEditorDataTemplateSelector" />

    <DataTemplate x:Key="ErrorReportTemplate">
        <TextBlock Text="{Binding Path=Error}">
            <TextBlock.Style>
                <Style TargetType="TextBlock">
                    <Setter Property="Foreground" Value="{StaticResource ValidationErrorBrush}" />
                    <Setter Property="Background" Value="{DynamicResource MaterialDesignPaper}" />
                    <Setter Property="FontSize" Value="10" />
                    <Setter Property="VerticalAlignment" Value="Center" />
                    <Style.Triggers>
                        <DataTrigger Binding="{Binding Path=HasErrors}" Value="False">
                            <Setter Property="Visibility" Value="Collapsed" />
                        </DataTrigger>
                    </Style.Triggers>
                </Style>
            </TextBlock.Style>
        </TextBlock>
    </DataTemplate>

    <!-- Begin Value Editors -->
    <DataTemplate x:Key="CheckboxEditor">
        <DockPanel>
            <CheckBox IsChecked="{Binding Path=Value}" HorizontalAlignment="Stretch" materialDesign:ValidationAssist.Suppress="True" />
            <ContentPresenter ContentTemplate="{StaticResource ErrorReportTemplate}" />
        </DockPanel>
    </DataTemplate>
    <DataTemplate x:Key="TextBoxEditor">
        <DockPanel>
            <TextBox DockPanel.Dock="Top" materialDesign:ValidationAssist.Suppress="True"
                     Text="{Binding Path=Value, Converter={StaticResource GenericConverter}, UpdateSourceTrigger=PropertyChanged}" 
                     HorizontalAlignment="Stretch" />
            <ContentPresenter DockPanel.Dock="Bottom" ContentTemplate="{StaticResource ErrorReportTemplate}" />
        </DockPanel>
    </DataTemplate>
    <DataTemplate x:Key="NumericEditor">
        <StackPanel>
            <mah:NumericUpDown  Value="{Binding Path=Value, Mode=TwoWay, Converter={StaticResource GenericConverter}}" />
            <ContentPresenter ContentTemplate="{StaticResource ErrorReportTemplate}" />
        </StackPanel>
    </DataTemplate>
    <DataTemplate x:Key="EnumComboBoxEditor">
        <StackPanel>
            <ComboBox Style="{StaticResource MaterialDesignComboBox}" 
                      ItemsSource="{extensions:Enumeration {Binding Path=ValueType}}" 
                      DisplayMemberPath="Description" 
                      SelectedValuePath="Value" 
                      SelectedValue="{Binding Path=Value}" />
            <ContentPresenter ContentTemplate="{StaticResource ErrorReportTemplate}" />
        </StackPanel>
    </DataTemplate>
    <DataTemplate x:Key="CollectionComboBoxEditor">
        <StackPanel>
            <ComboBox Style="{StaticResource MaterialDesignComboBox}" 
                      ItemsSource="{Binding Path=ConstraintImplementation.Choices}" 
                      SelectedValue="{Binding Path=Value, UpdateSourceTrigger=PropertyChanged}" 
                      DisplayMemberPath="Value" 
                      SelectedValuePath="Value" />
            <ContentPresenter ContentTemplate="{StaticResource ErrorReportTemplate}" />
        </StackPanel>
    </DataTemplate>
    <DataTemplate x:Key="RangeEditor">
        <DockPanel>
            <TextBox DockPanel.Dock="Right" materialDesign:ValidationAssist.Suppress="True"
                         Text="{Binding Path=Value, Converter={StaticResource GenericConverter}}" 
                         Width="50" />
            <ContentPresenter DockPanel.Dock="Bottom" ContentTemplate="{StaticResource ErrorReportTemplate}" />
            <Slider Orientation="Horizontal" TickPlacement="BottomRight"
                        Style="{StaticResource MaterialDesignDiscreteSlider}"
                        materialDesign:ValidationAssist.Suppress="True"
                        Maximum="{Binding Path=ConstraintImplementation.MaxValue, Mode=OneWay, Converter={StaticResource GenericConverter}}" 
                        Minimum="{Binding Path=ConstraintImplementation.MinValue, Mode=OneWay, Converter={StaticResource GenericConverter}}" 
                        Value="{Binding Path=Value, Mode=TwoWay, Converter={StaticResource GenericConverter}}"  />
        </DockPanel>
    </DataTemplate>
    <!-- End Value Editors -->

    <!-- Begin Default Value Editors -->
    <DataTemplate x:Key="DefaultValueCheckboxEditor">
        <StackPanel Orientation="Horizontal" VerticalAlignment="Center">
            <Label>Default Value: </Label>
            <CheckBox IsChecked="{Binding Path=DefaultValue}" HorizontalAlignment="Stretch" />
        </StackPanel>
    </DataTemplate>
    <DataTemplate x:Key="DefaultValueTextBoxEditor">
        <TextBox materialDesign:HintAssist.Hint="Default Value"
                 materialDesign:HintAssist.IsFloating="True"
                 Text="{Binding Path=DefaultValue}" HorizontalAlignment="Stretch" />
    </DataTemplate>
    <DataTemplate x:Key="DefaultValueNumericEditor">
        <mah:NumericUpDown materialDesign:HintAssist.Hint="Default Value"
                           materialDesign:HintAssist.IsFloating="True"
                           
                           Value="{Binding Path=DefaultValue, Converter={StaticResource GenericConverter}}" />
    </DataTemplate>
    <DataTemplate x:Key="DefaultValueEnumComboBoxEditor">
        <ComboBox Style="{StaticResource MaterialDesignComboBox}"
                  materialDesign:HintAssist.Hint="Default Value"
                  materialDesign:HintAssist.IsFloating="True"
                  ItemsSource="{extensions:Enumeration {Binding Path=ValueType}}" 
                  DisplayMemberPath="Description" 
                  SelectedValuePath="Value" 
                  SelectedValue="{Binding Path=DefaultValue}" />
    </DataTemplate>
    <DataTemplate x:Key="DefaultValueCollectionComboBoxEditor">
        <ComboBox Style="{StaticResource MaterialDesignComboBox}"
                  materialDesign:ComboBoxAssist.ClassicMode="True"
                  materialDesign:HintAssist.Hint="Default Value"
                  materialDesign:HintAssist.IsFloating="True"
                  SelectedValue="{Binding Path=DefaultValue}" 
                  DisplayMemberPath="Value" 
                  SelectedValuePath="Value">
            <ComboBox.Resources>
                <ext:BindingProxy x:Key="proxy" Data="{Binding}" />
            </ComboBox.Resources>
            <ComboBox.ItemsSource>
                <CompositeCollection>
                    <ComboBoxItem>No Default Value</ComboBoxItem>
                    <CollectionContainer Collection="{Binding Path=ConstraintImplementation.Choices, Source={StaticResource proxy}}" />
                </CompositeCollection>
            </ComboBox.ItemsSource>
        </ComboBox>
    </DataTemplate>
    <DataTemplate x:Key="DefaultValueRangeEditor">
        <DockPanel>
            <TextBox DockPanel.Dock="Right"
                    Text="{Binding Path=DefaultValue, Mode=OneWay, Converter={StaticResource GenericConverter}}" 
                    IsReadOnly="True" />
            
            <Slider Orientation="Horizontal" TickPlacement="BottomRight"
                    materialDesign:HintAssist.Hint="Default Value"
                    materialDesign:HintAssist.IsFloating="True"
                    Style="{StaticResource MaterialDesignDiscreteSlider}"
                    Maximum="{Binding Path=ConstraintImplementation.MaxValue, Mode=OneWay, Converter={StaticResource GenericConverter}}" 
                    Minimum="{Binding Path=ConstraintImplementation.MinValue, Mode=OneWay, Converter={StaticResource GenericConverter}}" 
                    Value="{Binding Path=DefaultValue, Mode=TwoWay, Converter={StaticResource GenericConverter}}"  />
        </DockPanel>
    </DataTemplate>
    <!-- End Default Value Editors -->


    <!-- Begin Choice Value Editors -->
    <DataTemplate x:Key="ChoiceCheckboxEditor">
        <CheckBox IsChecked="{Binding Path=Value}" HorizontalAlignment="Stretch" />
    </DataTemplate>
    <DataTemplate x:Key="ChoiceTextBoxEditor">
        <TextBox Text="{Binding Path=Value, Converter={StaticResource GenericConverter}}" HorizontalAlignment="Stretch" />
    </DataTemplate>
    <DataTemplate x:Key="ChoiceNumericEditor">
        <mah:NumericUpDown Value="{Binding Path=Value, Mode=TwoWay, Converter={StaticResource GenericConverter}}" />
    </DataTemplate>
    <DataTemplate x:Key="ChoiceEnumComboBoxEditor">
        <ComboBox Style="{StaticResource MaterialDesignComboBox}" 
                  ItemsSource="{extensions:Enumeration {Binding Path=ValueType}}" 
                  DisplayMemberPath="Description" 
                  SelectedValuePath="Value" 
                  SelectedValue="{Binding Path=Value}" />
    </DataTemplate>
    <DataTemplate x:Key="ChoiceCollectionComboBoxEditor">
        <ComboBox Style="{StaticResource MaterialDesignComboBox}" 
                  ItemsSource="{Binding Path=ConstraintImplementation.Choices}" 
                  SelectedValue="{Binding Path=Value}" 
                  DisplayMemberPath="Value" 
                  SelectedValuePath="Value" />
    </DataTemplate>
    <DataTemplate x:Key="ChoiceRangeEditor">
        <DockPanel>
            <TextBox DockPanel.Dock="Right" materialDesign:ValidationAssist.Suppress="True"
                         Text="{Binding Path=Value, Converter={StaticResource GenericConverter}}" 
                         Width="50" />
            <Slider Orientation="Horizontal" TickPlacement="BottomRight"
                    materialDesign:ValidationAssist.UsePopup="True"
                    materialDesign:ValidationAssist.PopupPlacement="Top"
                        Style="{StaticResource MaterialDesignDiscreteSlider}"
                        Maximum="{Binding Path=ConstraintImplementation.MaxValue, Mode=OneWay, Converter={StaticResource GenericConverter}}" 
                        Minimum="{Binding Path=ConstraintImplementation.MinValue, Mode=OneWay, Converter={StaticResource GenericConverter}}" 
                        Value="{Binding Path=Value, Mode=TwoWay, Converter={StaticResource GenericConverter}}"  />
        </DockPanel>
    </DataTemplate>
    <!-- End Choice Value Editors -->

</ResourceDictionary>